{% extends 'base.html' %}
{% block title %}Identificador de exoplanetas{% endblock %}
{% block head %}
<style>
  /* Overlay de búsqueda: animación de escaneo estelar */
  .scan-overlay{ position:fixed; inset:0; display:none; z-index:90; background:radial-gradient(1200px 800px at 50% -10%, rgba(50,90,200,.25), transparent 60%), rgba(4,8,24,.85); backdrop-filter: blur(2px); }
  body.searching .scan-overlay{ display:block }
  .scan-stars{ position:absolute; inset:0; background: radial-gradient(circle at 20% 30%, rgba(255,255,255,.35) 0 1px, transparent 2px), radial-gradient(circle at 70% 60%, rgba(255,255,255,.25) 0 1px, transparent 2px), radial-gradient(circle at 40% 80%, rgba(255,255,255,.25) 0 1px, transparent 2px); background-size: 400px 400px, 500px 500px, 450px 450px; animation: drift 10s linear infinite; opacity:.6 }
  .scan-beam{ position:absolute; left:50%; top:0; transform:translateX(-50%); width:2px; height:100%; background: linear-gradient(180deg, rgba(90,150,255,.0), rgba(90,150,255,.8), rgba(90,150,255,.0)); filter: blur(1px); animation: sweep 1.8s ease-in-out infinite }
  .scan-text{ position:absolute; inset:auto 0 12%; text-align:center; color:#cfe0ff; font-weight:700; letter-spacing:.06em }
  @keyframes drift{ to{ background-position: 200px 200px, -250px -200px, 150px -150px } }
  @keyframes sweep{ 0%{ left:20% } 50%{ left:80% } 100%{ left:20% } }

  /* Aparición del planeta en éxito */
  .planet-visual{ position:relative; width:220px; height:220px; border-radius:50%; margin:1.25rem auto 0; border:2px solid rgba(120,170,255,.35); background: radial-gradient(circle at 35% 35%, #2a6cff, #09163a 70%); box-shadow:0 18px 48px rgba(0,0,0,.45); transform: scale(.6); opacity:0; transition: transform .7s ease, opacity .7s ease }
  .planet-visual.show{ transform: scale(1); opacity:1 }
  .planet-visual::after{ content:""; position:absolute; inset:0; border-radius:50%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), rgba(255,255,255,0) 60%) }

  /* Galería de exoplanetas en éxito */
  .planet-gallery{ display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:1rem; margin-top:1.25rem }
  .planet-item{ position:relative; width:140px; height:140px; border-radius:50%; margin:0 auto; background-size:cover; background-position:center; border:2px solid rgba(120,170,255,.35); box-shadow:0 12px 30px rgba(0,0,0,.4); opacity:0; transform: scale(.8); transition: opacity .5s ease, transform .5s ease }
  .planet-item.show{ opacity:1; transform: scale(1) }
  @media (max-width: 560px){ .planet-item{ width:110px; height:110px } }

  /* Tooltips simples con title ya funcionan; agregamos ayuda visual */
  .form-grid label{ position:relative }
  .help{ display:inline-block; margin-left:.35rem; width:1.1rem; height:1.1rem; border-radius:999px; background:rgba(255,255,255,.12); border:1px solid rgba(120,170,255,.35); color:#cfe0ff; font-size:.75rem; line-height:1.1rem; text-align:center; cursor:help }
</style>
{% endblock %}
{% block content %}
<section class="page pad">
  <h1>Identificador de exoplanetas</h1>
  <form method="POST" class="form-grid" action="{{ url_for('identificador') }}">
    <label>Periodo (días) <span class="help" title="Tiempo que tarda el planeta en completar una órbita alrededor de su estrella.">i</span>
      <input type="number" step="any" name="period" required title="Días por órbita (periodo orbital)">
    </label>
    <label>Duración (días) <span class="help" title="Duración del tránsito: tiempo que el planeta pasa frente a la estrella.">i</span>
      <input type="number" step="any" name="duration" required title="Duración del tránsito">
    </label>
    <label>Profundidad <span class="help" title="Disminución de brillo durante el tránsito, relacionada con el tamaño del planeta.">i</span>
      <input type="number" step="any" name="depth" required title="Profundidad del tránsito (Delta de flujo)">
    </label>
    <label>Radio planeta (R⊕) <span class="help" title="Tamaño del planeta en radios terrestres (R⊕).">i</span>
      <input type="number" step="any" name="planet_radius" required title="Radio del planeta (R⊕)">
    </label>
    <label>Temperatura estrella (K) <span class="help" title="Temperatura efectiva de la estrella (Kelvin).">i</span>
      <input type="number" step="any" name="stellar_teff" required title="Temperatura efectiva (K)">
    </label>
    <label>Radio estrella (R☉) <span class="help" title="Tamaño de la estrella en radios solares (R☉).">i</span>
      <input type="number" step="any" name="stellar_radius" required title="Radio de la estrella (R☉)">
    </label>
    <label>Masa estrella (M☉) <span class="help" title="Masa de la estrella en masas solares (M☉).">i</span>
      <input type="number" step="any" name="stellar_mass" required title="Masa de la estrella (M☉)">
    </label>
    <label>Insolación <span class="help" title="Flujo de energía que recibe el planeta desde su estrella (relativo a la Tierra)."><span>i</span></span>
      <input type="number" step="any" name="insolation" required title="Insolación (relativa a la Tierra)">
    </label>
    <div style="grid-column:1/-1">
      <button class="btn primary" type="submit">Predecir</button>
      <a class="btn ghost" href="{{ url_for('herramienta') }}">Volver</a>
    </div>
  </form>

  {% if prediction %}
    <div class="result">Resultado: {{ prediction }}</div>
    {% set success = (prediction != 'No es un exoplaneta') %}
    {% if success %}
      <div class="planet-gallery" id="planet-gallery" aria-hidden="true">
        <div class="planet-item" style="background-image:url('https://s1.significados.com/foto/earth-11015-1920-41.jpg?class=article')"></div>
      </div>
    {% else %}
      <div class="planet-visual" aria-hidden="true"></div>
    {% endif %}
  {% endif %}

  <!-- Overlay de escaneo mientras se procesa la predicción -->
  <div class="scan-overlay" aria-hidden="true">
    <div class="scan-stars"></div>
    <div class="scan-beam"></div>
    <div class="scan-text">Buscando señales de un planeta...</div>
  </div>
</section>
{% endblock %}
{% block scripts %}
<script>
  // Muestra overlay de búsqueda durante el envío
  (function(){
    const form = document.querySelector("form[action='{{ url_for('identificador') }}']");
    if (!form) return;
    form.addEventListener('submit', function(){
      document.body.classList.add('searching');
    });
    // Al cargar/volver, quitar overlay
    window.addEventListener('pageshow', function(){
      document.body.classList.remove('searching');
    });
  })();

  // Efecto de aparición escalonado para la galería en éxito
  (function(){
    const gallery = document.getElementById('planet-gallery');
    if (!gallery) return;
    const items = Array.from(gallery.querySelectorAll('.planet-item'));
    items.forEach((el, i) => setTimeout(() => el.classList.add('show'), 120 * i));
  })();
</script>
{% endblock %}
